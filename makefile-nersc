D?=0
MAXDIM?=128

ifeq ($(D),1)
FLAGS=-O0 -g -fsanitize=address -fno-omit-frame-pointer -std=c++20 -DMAX_DIM=$(MAXDIM)
else
FLAGS=-O3 -std=c++20 -DMAX_DIM=$(MAXDIM)
endif

COMPILER=CC
INCLUDES=-I./include

all: rgraph systolic

rgraph: rgraph.cpp src/point_vector.cpp src/global_point.cpp src/cover_tree.cpp src/dist_voronoi.cpp src/dist_query.cpp src/ghost_tree.cpp src/work_stealer.cpp
	$(COMPILER) -o $@ $(INCLUDES) $(FLAGS) $^

systolic: systolic.cpp src/point_vector.cpp src/cover_tree.cpp src/utils.cpp
	$(COMPILER) -o $@ $(INCLUDES) $(FLAGS) $^

clean:
	rm -rf *.dSYM *.so rgraph systolic
